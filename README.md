# NixOS Configuration Installation Guide

This repository contains a complete NixOS configuration with Hyprland desktop environment, designed for easy installation on fresh NixOS systems.

## What You'll Get

- **Desktop Environment**: Hyprland (modern Wayland compositor) with Waybar status bar
- **Terminal**: Kitty terminal emulator
- **Launcher**: Fuzzel application launcher
- **Shell**: Fish shell with useful aliases
- **Notifications**: Dunst notification daemon
- **Screenshots**: Swappy screenshot tool with Grim
- **Fonts**: Fira Code Nerd Font for terminal/coding
- **Swedish Keyboard Layout**: Configured for Swedish users

## Prerequisites

- Fresh NixOS installation with "no desktop" option (as you've done)
- UEFI system (uses systemd-boot)
- Internet connection
- Basic terminal access

## Installation Steps

### Step 1: Initial System Setup

First, ensure you have git available:

```bash
# Install git if not available (run as normal user)
nix-shell -p git
```

### Step 2: Clone This Repository

```bash
# Clone to your home directory (as normal user)
cd ~  # Go to your home directory
git clone git@gitlab.com:marerm/nixos-config.git  # Replace with your repo URL if different
cd nixos-config
```

### Step 3: Generate Hardware Configuration

The most important step - generate your machine's hardware configuration:

```bash
# Generate hardware config for your specific machine (needs sudo)
sudo nixos-generate-config --show-hardware-config > hosts/nixos/hardware-configuration.nix
```

### Step 4: Update User Configuration (If Needed)

If your username is not "martin", you need to update the configuration:

1. Edit `hosts/common.nix` line 26 to change the username
2. Edit `flake.nix` line 20 to update the home-manager user
3. Edit `home.nix` line 58 to update the rebuild alias

### Step 5: Apply the Configuration

```bash
# Rebuild with your new configuration (needs sudo)
sudo nixos-rebuild switch --flake .#nixos

# If you encounter any issues, try:
sudo nixos-rebuild switch --flake .#nixos --show-trace
```

### Step 6: Reboot

```bash
# Reboot to apply changes (needs sudo)
sudo reboot
```

After reboot, you should have a fully functional Hyprland desktop environment!

## Post-Installation

### First Login to Hyprland

1. At the login screen, select Hyprland as your session
2. Log in with your user credentials
3. You'll see Waybar at the top and a clean desktop

### Essential Keybindings

The Hyprland configuration includes these default keybindings:

- `Super + Return`: Open terminal (Kitty)
- `Super + D`: Open application launcher (Fuzzel)
- `Super + Q`: Close active window
- `Super + Numbers (1-9)`: Switch workspaces
- `Super + Shift + Numbers`: Move window to workspace
- `Super + Mouse`: Move/resize windows

### Making Changes

After making any changes to the configuration:

```bash
# Use the convenient alias (defined in home.nix)
update

# Or manually:
sudo nixos-rebuild switch --flake ~/nixos-config/#nixos
```

## Configuration Structure

```
nixos-config/
├── flake.nix              # Main flake configuration
├── flake.lock             # Lock file (don't edit manually)
├── home.nix               # Home Manager configuration
├── hosts/
│   ├── common.nix         # Settings for all machines
│   └── nixos/             # Your production PC config
│       ├── configuration.nix
│       └── hardware-configuration.nix  # Generated by you
└── dotfiles/              # Desktop environment configs
    ├── hypr/              # Hyprland configuration
    ├── waybar/            # Status bar configuration
    ├── kitty/             # Terminal configuration
    └── ...                # Other app configs
```

## Troubleshooting

### Build Fails
- Check that `hardware-configuration.nix` exists in `hosts/nixos/`
- Ensure you're running as root or with `sudo`
- Try adding `--show-trace` to see detailed error messages

### Desktop Not Starting
- Verify your system has proper graphics drivers
- Check that Hyprland is selected at login screen
- Review `/var/log/display-manager.log` for errors

### Wrong Keyboard Layout
- The config is set to Swedish layout (`se`)
- To change: edit `hosts/common.nix` line 16 and line 17
- Common layouts: `us`, `uk`, `de`, `fr`

### Username Issues
- If your username isn't "martin", update all references in:
  - `hosts/common.nix` 
  - `flake.nix`
  - `home.nix`

## Customization

### Adding Packages
Add packages to `home.nix` in the `home.packages` section.

### Desktop Tweaks
- Hyprland: Edit `dotfiles/hypr/hyprland.conf`
- Waybar: Edit `dotfiles/waybar/config` and `dotfiles/waybar/style.css`
- Terminal: Edit `dotfiles/kitty/kitty.conf`

### System Settings
Edit `hosts/common.nix` for system-wide changes that apply to all machines.

## Advanced: Multiple Machines

This configuration supports multiple machines. To add a new machine:

1. Create `hosts/your-machine-name/`
2. Add `configuration.nix` and `hardware-configuration.nix`
3. Update `flake.nix` to include the new configuration
4. Build with `--flake .#your-machine-name`

## Getting Help

- [NixOS Manual](https://nixos.org/manual/nixos/stable/)
- [Home Manager Options](https://nix-community.github.io/home-manager/options.html)
- [Hyprland Documentation](https://wiki.hyprland.org/)

Remember: NixOS configurations are declarative and reproducible. If something breaks, you can always rollback with `sudo nixos-rebuild switch --rollback`!