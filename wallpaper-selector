#!/usr/bin/env bash

# Simple wallpaper selector for rofi
# Lists wallpapers from ~/Pictures/Wallpapers and sets them with swww + matugen

WALLPAPER_DIR="$HOME/Pictures/Wallpapers"

# Check if wallpaper directory exists
if [[ ! -d "$WALLPAPER_DIR" ]]; then
    echo "No wallpaper directory found"
    echo "Please create $WALLPAPER_DIR and add images"
    exit 0
fi

# If no argument provided, list wallpapers for rofi
if [[ $# -eq 0 ]]; then
    # List all image files
    find "$WALLPAPER_DIR" -type f \( -iname "*.jpg" -o -iname "*.jpeg" -o -iname "*.png" -o -iname "*.webp" -o -iname "*.gif" \) -exec basename {} \; 2>/dev/null | sort
    exit 0
fi

# Set the selected wallpaper
selected_wallpaper="$1"
wallpaper_path="$WALLPAPER_DIR/$selected_wallpaper"

if [[ ! -f "$wallpaper_path" ]]; then
    notify-send "Error" "Wallpaper not found: $selected_wallpaper"
    exit 1
fi

# Set wallpaper with swww
swww img "$wallpaper_path" --transition-type wipe --transition-duration 1

# Generate theme with matugen
matugen image "$wallpaper_path" --variant dark --json-format hex

# Reload applications to pick up new colors
pkill -SIGUSR2 waybar 2>/dev/null || true
pkill -SIGUSR1 kitty 2>/dev/null || true
pkill -SIGUSR2 dunst 2>/dev/null || true
hyprctl reload 2>/dev/null || true

# Show notification
notify-send "Wallpaper Changed" "$selected_wallpaper" -i "$wallpaper_path"
